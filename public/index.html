<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í–‰ì„± ì¶”ì²œê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; padding: 2em; max-width: 700px; margin: auto; }
    label { display: block; font-weight: bold; margin-top: 1em; }
    select, input, button {
      width: 100%; padding: 0.5em; font-size: 1em; margin-top: 0.3em; box-sizing: border-box;
    }
    #result { margin-top: 2em; font-size: 1.1em; font-weight: bold; }
    #resetSection { margin-top: 1.5em; display: none; }
    table { margin-top: 1em; width: 100%; border-collapse: collapse; font-size: 0.9em; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f0f0f0; }
    @media (max-width: 480px) {
      body { padding: 1em; }
      table, th, td { font-size: 0.8em; }
    }
  </style>
</head>
<body>
  <h1>ë‚˜ì—ê²Œ ë§ëŠ” í–‰ì„± ì¶”ì²œ</h1>

  <label for="nickname">1. ë³„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</label>
  <input type="text" id="nickname" required placeholder="ì˜ˆ: ìœ¤ì„œ" />

  <label>2. í•˜ë£¨ ìˆ˜ë©´ ì‹œê°„ì€ í‰ê· ì ìœ¼ë¡œ ì–¼ë§ˆë‚˜ ë˜ì‹œë‚˜ìš”?</label>
  <select id="sleepTime">
    <option>5ì‹œê°„ ì´í•˜</option>
    <option>5-7ì‹œê°„</option>
    <option>7-8ì‹œê°„</option>
    <option>8-10ì‹œê°„</option>
    <option>10ì‹œê°„ ì´ìƒ</option>
  </select>

  <label>3. ë³´í†µ ëª‡ì‹œì— ì£¼ë¬´ì‹œë‚˜ìš”?</label>
  <select id="sleepStart">
    <option>22ì‹œ ì´ì „</option>
    <option>22-0ì‹œ</option>
    <option>0-2ì‹œ</option>
    <option>2ì‹œ ì´í›„</option>
  </select>

  <label>4. ë³´í†µ ëª‡ì‹œê°„ ì „ì— í™œë™ì„ ì‹œì‘í•˜ì‹œë‚˜ìš”?</label>
  <select id="activeStart">
    <option>2ì‹œê°„ ì´ìƒ ì „ì— ì¤€ë¹„</option>
    <option>2ì‹œê°„-1ì‹œê°„ ì „</option>
    <option>1ì‹œê°„-30ë¶„ ì „</option>
    <option>30ë¶„ ì´ë‚´</option>
  </select>

  <label>5. í•˜ë£¨ ì‹ì‚¬ íšŸìˆ˜ëŠ” ëª‡ë²ˆì¸ê°€ìš”?</label>
  <select id="mealCount">
    <option>1íšŒ</option>
    <option>2íšŒ</option>
    <option>3íšŒ</option>
    <option>3íšŒ ì´ìƒ</option>
  </select>

  <button onclick="submitForm()">í–‰ì„± ì¶”ì²œ ë°›ê¸°</button>

  <div id="result" style="display:none;">
    <p id="recommendationText"></p>
  </div>

  <div id="resetSection" style="display:none;">
    <button onclick="resetForm()">ğŸ” ë‹¤ì‹œ ì¶”ì²œ ë°›ê¸°</button>
  </div>

  <div style="margin-top: 1.5em;">
    <button onclick="location.href='stats.html'">ğŸ“Š ì¶”ì²œ í†µê³„ ë³´ê¸°</button>
    <button onclick="togglePlanetTable()">ğŸª í–‰ì„± ê¸°ì¤€í‘œ ë³´ê¸°</button>
    <button onclick="location.href='responses.html'">ğŸ“„ ì „ì²´ ì‘ë‹µ ë³´ê¸°</button>
    <button onclick="triggerReset()">ğŸ§¹ ì‘ë‹µ ê¸°ë¡ ì´ˆê¸°í™”</button>
  </div>

  <div id="planetTable" style="display:none; margin-top: 2em;">
    <h2>ì¶”ì²œ í–‰ì„± ê¸°ì¤€í‘œ</h2>
    <table>
      <tr><th>ì ìˆ˜</th><th>í–‰ì„±</th><th>ì£¼ê¸°</th><th>ì„¤ëª…</th></tr>
      <tr><td>0~24</td><td>Hypothetical-X2</td><td>20</td><td>ê·¹ë‹¨ì ìœ¼ë¡œ ì§§ì€ ë¦¬ë“¬</td></tr>
      <tr><td>25~35</td><td>Hypothetical-X1</td><td>22</td><td>ì§§ì€ ìƒí™œ ë¦¬ë“¬</td></tr>
      <tr><td>36~45</td><td>TRAPPIST-1c</td><td>23.5</td><td>ì•½ê°„ ì§§ì€ ì£¼ê¸°</td></tr>
      <tr><td>46~55</td><td>Earth / TRAPPIST-1d</td><td>24</td><td>ì§€êµ¬ ìœ ì‚¬í˜•</td></tr>
      <tr><td>56~65</td><td>Mars</td><td>24.6</td><td>ì§€êµ¬ ë¹„ìŠ·</td></tr>
      <tr><td>66~75</td><td>Wolf 1061c</td><td>25</td><td>ì‚´ì§ ì¥ì£¼ê¸°í˜•</td></tr>
      <tr><td>76~80</td><td>Kepler-452b</td><td>26</td><td>ì¥ì£¼ê¸° ìƒí™œì</td></tr>
      <tr><td>81~85</td><td>Proxima b</td><td>28</td><td>ì¥ì£¼ê¸° ìƒí™œì— ìµìˆ™í•œ ì‚¬ìš©ì</td></tr>
      <tr><td>86~90</td><td>HD 40307 g</td><td>30</td><td>ê·¹ì¥ì£¼ê¸° ì§ì „ ë¦¬ë“¬ ì‹¤í—˜ì</td></tr>
      <tr><td>91~95</td><td>Kepler-186f</td><td>33</td><td>ë§¤ìš° ê¸´ í™œë™ì</td></tr>
      <tr><td>96~100</td><td>Gliese 581 d</td><td>36</td><td>ê·¹ì¥ì£¼ê¸°í˜•</td></tr>
    </table>
  </div>

  <script>
    function togglePlanetTable() {
      const table = document.getElementById("planetTable");
      table.style.display = table.style.display === "none" ? "block" : "none";
    }

    function calculateScore(answers) {
      const sleepScoreMap = {
        "5ì‹œê°„ ì´í•˜": 50, "5-7ì‹œê°„": 40, "7-8ì‹œê°„": 30, "8-10ì‹œê°„": 20, "10ì‹œê°„ ì´ìƒ": 10
      };
      const sleepStartScore = {
        "22ì‹œ ì´ì „": 0, "22-0ì‹œ": 5, "0-2ì‹œ": 10, "2ì‹œ ì´í›„": 15
      };
      const mealScoreMap = {
        "1íšŒ": 10, "2íšŒ": 5, "3íšŒ": 0, "3íšŒ ì´ìƒ": -5
      };
      const activeScoreMap = {
        "2ì‹œê°„ ì´ìƒ ì „ì— ì¤€ë¹„": 0, "2ì‹œê°„-1ì‹œê°„ ì „": 3,
        "1ì‹œê°„-30ë¶„ ì „": 6, "30ë¶„ ì´ë‚´": 10
      };

      let score =
        sleepScoreMap[answers.sleepTime] * 2 +
        sleepStartScore[answers.sleepStart] * 1.5 +
        mealScoreMap[answers.mealCount] * 1.2 +
        activeScoreMap[answers.activeStart] * 1.0;

      return Math.max(0, Math.round(score));
    }

    function getPlanetInfo(score) {
      const planets = [
          { min: 0, max: 24, name: "Hypothetical-X2 (20ì‹œê°„)", reason: "ê·¹ë‹¨ì ìœ¼ë¡œ ì§§ì€ ë¦¬ë“¬" },
          { min: 25, max: 35, name: "Hypothetical-X1 (22ì‹œê°„)", reason: "ì§§ì€ ìƒí™œ ë¦¬ë“¬" },
          { min: 36, max: 45, name: "TRAPPIST-1c (23.5ì‹œê°„)", reason: "ì•½ê°„ ì§§ì€ ì£¼ê¸°" },
          { min: 46, max: 55, name: "Earth / TRAPPIST-1d (24ì‹œê°„)", reason: "ì§€êµ¬ ìœ ì‚¬í˜•" },
          { min: 56, max: 65, name: "Mars (24.6ì‹œê°„)", reason: "ì§€êµ¬ ë¹„ìŠ·" },
          { min: 66, max: 75, name: "Wolf 1061c (25ì‹œê°„)", reason: "ì‚´ì§ ì¥ì£¼ê¸°í˜•" },
          { min: 76, max: 80, name: "Kepler-452b (26ì‹œê°„)", reason: "ì¥ì£¼ê¸° ìƒí™œì" },
          { min: 81, max: 85, name: "Proxima b (28ì‹œê°„)", reason: "ì¥ì£¼ê¸° ìƒí™œì— ìµìˆ™í•œ ì‚¬ìš©ì" },
          { min: 86, max: 90, name: "HD 40307 g (30ì‹œê°„)", reason: "ê·¹ì¥ì£¼ê¸° ì§ì „ ë¦¬ë“¬ ì‹¤í—˜ì" },
          { min: 91, max: 95, name: "Kepler-186f (33ì‹œê°„)", reason: "ë§¤ìš° ê¸´ í™œë™ì" },
          { min: 96, max: 100, name: "Gliese 581 d (36ì‹œê°„)", reason: "ê·¹ì¥ì£¼ê¸°í˜•" }
        ];

        let exact = planets.find(p => score >= p.min && score <= p.max);
        if (exact) return exact;

        // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” êµ¬ê°„ì´ ì—†ì„ ê²½ìš°, ê°€ì¥ ê°€ê¹Œìš´ ì ìˆ˜ êµ¬ê°„ìœ¼ë¡œ ì¶”ì²œ
        let closest = planets.reduce((prev, curr) => {
          const prevDist = Math.abs(score - ((prev.min + prev.max) / 2));
          const currDist = Math.abs(score - ((curr.min + curr.max) / 2));
          return currDist < prevDist ? curr : prev;
      });

      return closest;
    }


    async function submitForm() {
      const nickname = document.getElementById("nickname").value.trim();
      const sleepTime = document.getElementById("sleepTime").value;
      const sleepStart = document.getElementById("sleepStart").value;
      const activeStart = document.getElementById("activeStart").value;
      const mealCount = document.getElementById("mealCount").value;

      const answers = { sleepTime, sleepStart, activeStart, mealCount };
      const score = calculateScore(answers);
      const planetInfo = getPlanetInfo(score);

      document.getElementById("recommendationText").innerHTML =
        `ğŸª <strong>${nickname}ë‹˜, ì¶”ì²œ í–‰ì„±ì€ ${planetInfo.name}ì…ë‹ˆë‹¤.</strong><br>${planetInfo.reason}`;
      document.getElementById("result").style.display = "block";
      document.getElementById("resetSection").style.display = "block";

      await fetch("/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          nickname, sleepTime, sleepStart, activeStart, mealCount, score, planet: planetInfo.name
        })
      });
    }

    function resetForm() {
      document.getElementById("nickname").value = "";
      document.getElementById("sleepTime").selectedIndex = 0;
      document.getElementById("sleepStart").selectedIndex = 0;
      document.getElementById("activeStart").selectedIndex = 0;
      document.getElementById("mealCount").selectedIndex = 0;
      document.getElementById("result").style.display = "none";
      document.getElementById("resetSection").style.display = "none";
      document.getElementById("planetTable").style.display = "none";
    }

    function triggerReset() {
      const pw = prompt("ì‘ë‹µì„ ì´ˆê¸°í™”í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
      if (!pw) return;
      fetch("/reset-data", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password: pw })
      })
      .then(res => res.json())
      .then(result => {
        if (result.success) {
          alert("âœ… ì‘ë‹µì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
          location.reload();
        } else {
          alert("âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
        }
      });
    }
  </script>
</body>
</html>
